name: Post to LinkedIn

on:
    workflow_dispatch:
        inputs:
            text:
                description: "Text content for the LinkedIn post"
                required: false
                default: ""
            url:
                description: "Optional URL to include with the post"
                required: false
                default: ""
            production:
                description: "Set to true to actually post instead of dry-run"
                required: false
                default: "false"

jobs:
    post:
        name: Post to LinkedIn
        runs-on: ubuntu-latest
        env:
            # Read-only secrets; unaffected by workflow inputs
            LINKEDIN_ACCESS_TOKEN: ${{ secrets.LINKEDIN_ACCESS_TOKEN }}
            LINKEDIN_PERSON_URN: ${{ secrets.LINKEDIN_PERSON_URN }}
        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Setup Python
              uses: actions/setup-python@v4
              with:
                  python-version: "3.11"

            - name: Install dependencies
              run: |
                  python -m pip install --upgrade pip
                  if [ -f requirements.txt ]; then python -m pip install -r requirements.txt; fi

            - name: Run LinkedIn post script
              run: |
                  DRY='--dry-run'
                  if [ "${{ github.event.inputs.production || 'false' }}" = 'true' ]; then
                    DRY=''
                  fi
                  python scripts/post_to_linkedin.py --text "${{ github.event.inputs.text }}" --url "${{ github.event.inputs.url }}" $DRY
              env:
                  LINKEDIN_ACCESS_TOKEN: ${{ secrets.LINKEDIN_ACCESS_TOKEN }}
                  LINKEDIN_PERSON_URN: ${{ secrets.LINKEDIN_PERSON_URN }}
