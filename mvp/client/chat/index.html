<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LuminAI MVP - Client Chat</title>
    <style>
      body { font-family: system-ui, Arial; background:#f4f4f6; padding: 20px; }
      .chat { max-width: 720px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
      .messages { border: 1px solid #eee; padding: 10px; min-height: 200px; margin-bottom: 12px; background:#fafafa }
      .msg { margin-bottom: 8px; }
      .user { color: #1a1a1a; font-weight: 600 }
      .bot { color: #333; font-style: italic }
    </style>
  </head>
  <body>
    <div class="chat">
      <h2>LuminAI MVP â€” Client Chat (Prototype)</h2>
      <div class="messages" id="messages"></div>
      <div style="margin-bottom:8px">
        <input id="clientId" placeholder="client id (e.g., client123)" style="width:28%; margin-right:8px" />
        <input id="message" placeholder="Type your message..." style="width:48%" />
        <label style="margin-left:8px"><input type="checkbox" id="privateMsg"/> private</label>
        <button id="send">Send</button>
      </div>
      <div style="margin-top:8px">
        <button id="logCraving">Log Craving</button>
        <a href="/resources.html" style="margin-left:12px">Harm reduction resources</a>
        <a href="/therapist/reports/index.html" style="margin-left:12px">Therapist reports (demo)</a>
      </div>
      <p style="margin-top:8px; font-size:0.9rem; color:#666">Note: This is a proof-of-concept prototype and not a replacement for real care.</p>
    </div>

    <script>
      const messagesEl = document.getElementById('messages');
      const messageInput = document.getElementById('message');
      const clientIdInput = document.getElementById('clientId');
      document.getElementById('send').addEventListener('click', async () => {
        const clientId = clientIdInput.value || 'anon';
        const message = messageInput.value.trim();
        if (!message) return;
        addMessage('You', message, 'user');
        messageInput.value = '';
        const isPrivate = document.getElementById('privateMsg').checked;
        const resp = await fetch('/api/chat', {
          method: 'POST', headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ client_id: clientId, message, private: isPrivate })
        });
        const j = await resp.json();
        if (j.reply) addMessage('LuminAI', j.reply.text, 'bot');
      });
      function addMessage(who, text, kind) {
        const div = document.createElement('div');
        div.className = 'msg ' + kind;
        div.innerHTML = `<div class="user">${who}:</div><div>${text}</div>`;
        messagesEl.appendChild(div);
        messagesEl.scrollTop = messagesEl.scrollHeight;
      }
        document.getElementById('logCraving').addEventListener('click', async () => {
          const clientId = document.getElementById('clientId').value || 'anon';
          const severity = prompt('Craving severity (1-5)', '3');
          const note = prompt('Optional note (e.g., trigger/context)', '');
          const resp = await fetch('/api/craving', {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ client_id: clientId, severity: Number(severity), note })
          });
          const j = await resp.json();
          if (j.ok) addMessage('System', 'Craving logged', 'bot');
        });
    </script>
  </body>
</html>
