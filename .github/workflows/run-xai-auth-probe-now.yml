name: run-xai-auth-probe-now
on:
  workflow_dispatch:

jobs:
  probe:
    runs-on: ubuntu-latest
    steps:
      - name: Run authenticated curl probe
        env:
          XAI_API_KEY: ${{ secrets.XAI_API_KEY }}
        run: |
          set -euo pipefail
          mkdir -p diagnostics
          cat > /tmp/payload.json <<'PAY'
{"model":"grok-2","messages":[{"role":"user","content":"Automated probe: are you online?"}],"max_tokens":60}
PAY
          curl -sS -H "Authorization: Bearer ${XAI_API_KEY}" -H "Content-Type: application/json" -d @/tmp/payload.json https://api.x.ai/v1/chat/completions -o diagnostics/xai-auth-probe.json -w "\n%{http_code}\n" || true

      - name: Upload probe artifact
        uses: actions/upload-artifact@v4
        with:
          name: xai-auth-probe
          path: diagnostics/xai-auth-probe.json
